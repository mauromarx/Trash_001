<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>Query</title>
  <link rel="stylesheet" type="text/css" href="query.css">
  <link rel="icon" href="https://insider.lexisnexis.com/share/res/favicon.ico">
  <!-- <script src = "main.js" type='module' defer></script> -->
</head>
<body>
  <div class="formbg-outer">
    <div class="formbg">
      <div class="formbg-inner padding-horizontal--48">
        <h2><span class="padding-bottom--24 flex-flex flex-justifyContent--center" style="font-size:80%;"> &#128178; Preço do Imóvel por Estado &#128176; </span></h2>
        <form id="stripe-login">
          <div class="field_st padding-bottom--8">
            <label for="name">Estados (EUA): ______ 01 _______________________ 02 _______________________ 03</label>
            <select name="_state_01" id="_state_01">
              <option value=""> </option>
              <option value="AL"> Alabama</option>
              <option value="AK"> Alasca</option>
              <option value="AZ"> Arizona</option>
              <option value="AR"> Arkansas</option>
              <option value="CA"> Califórnia</option>
              <option value="NC"> Carolina do Norte</option>
              <option value="SC"> Carolina do Sul</option>
              <option value="CO"> Colorado</option>
              <option value="CT"> Connecticut</option>
              <option value="DE"> Delaware</option>
              <option value="FL"> Flórida</option>
              <option value="GA"> Geórgia</option>
              <option value="HI"> Havaí</option>
              <option value="ID"> Idaho</option>
              <option value="IL"> Illinois</option>
              <option value="IN"> Indiana</option>
              <option value="IA"> Iowa</option>
              <option value="KS"> Kansas</option>
              <option value="KY"> Kentucky</option>
              <option value="LA"> Louisiana</option>
              <option value="MD"> Maryland</option>
              <option value="MA"> Massachusetts</option>
              <option value="MI"> Michigan</option>
              <option value="MN"> Minnesota</option>
              <option value="MO"> Missouri</option>
              <option value="MT"> Montana</option>
              <option value="NE"> Nebraska</option>
              <option value="NV"> Nevada</option>
              <option value="NH"> Nova Hampshire</option>
              <option value="NY"> Nova Iorque</option>
              <option value="NJ"> Nova Jérsei</option>
              <option value="NM"> Novo México</option>
              <option value="OH"> Ohio</option>
              <option value="OK"> Oklahoma</option>
              <option value="OR"> Oregon</option>
              <option value="PA"> Pensilvânia</option>
              <option value="RI"> Rhode Island</option>
              <option value="TN"> Tennessee</option>
              <option value="TX"> Texas</option>
              <option value="UT"> Utah</option>
              <option value="VA"> Virgínia</option>
              <option value="WA"> Washington</option>
              <option value="WI"> Wisconsin</option>
              <option value="WY"> Wyoming</option>
            </select>
            <select name="_state_02" id="_state_02">
              <option value=""> </option>
              <option value="AL"> Alabama</option>
              <option value="AK"> Alasca</option>
              <option value="AZ"> Arizona</option>
              <option value="AR"> Arkansas</option>
              <option value="CA"> Califórnia</option>
              <option value="NC"> Carolina do Norte</option>
              <option value="SC"> Carolina do Sul</option>
              <option value="CO"> Colorado</option>
              <option value="CT"> Connecticut</option>
              <option value="DE"> Delaware</option>
              <option value="FL"> Flórida</option>
              <option value="GA"> Geórgia</option>
              <option value="HI"> Havaí</option>
              <option value="ID"> Idaho</option>
              <option value="IL"> Illinois</option>
              <option value="IN"> Indiana</option>
              <option value="IA"> Iowa</option>
              <option value="KS"> Kansas</option>
              <option value="KY"> Kentucky</option>
              <option value="LA"> Louisiana</option>
              <option value="MD"> Maryland</option>
              <option value="MA"> Massachusetts</option>
              <option value="MI"> Michigan</option>
              <option value="MN"> Minnesota</option>
              <option value="MO"> Missouri</option>
              <option value="MT"> Montana</option>
              <option value="NE"> Nebraska</option>
              <option value="NV"> Nevada</option>
              <option value="NH"> Nova Hampshire</option>
              <option value="NY"> Nova Iorque</option>
              <option value="NJ"> Nova Jérsei</option>
              <option value="NM"> Novo México</option>
              <option value="OH"> Ohio</option>
              <option value="OK"> Oklahoma</option>
              <option value="OR"> Oregon</option>
              <option value="PA"> Pensilvânia</option>
              <option value="RI"> Rhode Island</option>
              <option value="TN"> Tennessee</option>
              <option value="TX"> Texas</option>
              <option value="UT"> Utah</option>
              <option value="VA"> Virgínia</option>
              <option value="WA"> Washington</option>
              <option value="WI"> Wisconsin</option>
              <option value="WY"> Wyoming</option>
            </select>
            <select name="_state_03" id="_state_03">
              <option value=""> </option>
              <option value="AL"> Alabama</option>
              <option value="AK"> Alasca</option>
              <option value="AZ"> Arizona</option>
              <option value="AR"> Arkansas</option>
              <option value="CA"> Califórnia</option>
              <option value="NC"> Carolina do Norte</option>
              <option value="SC"> Carolina do Sul</option>
              <option value="CO"> Colorado</option>
              <option value="CT"> Connecticut</option>
              <option value="DE"> Delaware</option>
              <option value="FL"> Flórida</option>
              <option value="GA"> Geórgia</option>
              <option value="HI"> Havaí</option>
              <option value="ID"> Idaho</option>
              <option value="IL"> Illinois</option>
              <option value="IN"> Indiana</option>
              <option value="IA"> Iowa</option>
              <option value="KS"> Kansas</option>
              <option value="KY"> Kentucky</option>
              <option value="LA"> Louisiana</option>
              <option value="MD"> Maryland</option>
              <option value="MA"> Massachusetts</option>
              <option value="MI"> Michigan</option>
              <option value="MN"> Minnesota</option>
              <option value="MO"> Missouri</option>
              <option value="MT"> Montana</option>
              <option value="NE"> Nebraska</option>
              <option value="NV"> Nevada</option>
              <option value="NH"> Nova Hampshire</option>
              <option value="NY"> Nova Iorque</option>
              <option value="NJ"> Nova Jérsei</option>
              <option value="NM"> Novo México</option>
              <option value="OH"> Ohio</option>
              <option value="OK"> Oklahoma</option>
              <option value="OR"> Oregon</option>
              <option value="PA"> Pensilvânia</option>
              <option value="RI"> Rhode Island</option>
              <option value="TN"> Tennessee</option>
              <option value="TX"> Texas</option>
              <option value="UT"> Utah</option>
              <option value="VA"> Virgínia</option>
              <option value="WA"> Washington</option>
              <option value="WI"> Wisconsin</option>
              <option value="WY"> Wyoming</option>
            </select>
<!--
            <input type="text" id="_state_01"/>
            <input type="text" id="_state_02"/>
            <input type="text" id="_state_03"/>
-->
          </div>
          <div class="field padding-bottom--8">
            <label for="rating">Valor avaliado:</label>
            <input type="text" id="assess_val" />
          </div>
          <div class="field padding-bottom--8">
            <label for="rating">Nº de quartos:</label>
            <input type="text" id="bedrooms" />
          </div>
          <div class="field padding-bottom--8">
            <label for="rating">Nº de banheiros:</label>
            <input type="text" id="full_baths" />
          </div>
          <div class="field padding-bottom--8">
            <label for="rating">Nº de lavabos:</label>
            <input type="text" id="half_baths" />
          </div>
          <div class="field padding-bottom--8">
            <label for="rating">Área construída (ft<sup>2</sup>):</label>
            <input type="text" id="land_sq_ft" />
          </div>
          <div class="field padding-bottom--8">
            <label for="rating">Área interna (ft<sup>2</sup>):</label>
            <input type="text" id="living_sq_ft" />
          </div>
          <div class="field padding-bottom--8">
            <label for="rating">Ano de aquisição [AAAA]:</label>
            <input type="text" id="year_acq" />
          </div>
          <div class="field padding-bottom--8">
            <label for="rating">Ano de construção [AAAA]:</label>
            <input type="text" id="year_built" />
          </div>
          <div class="field padding-bottom--24">
            <label for="rating">CEP.:</label>
            <input type="text" id="zip" />
          </div>
          <div class="field padding-bottom--12">
            <input type="button" id="botao" value="Consulta">
          </div>
          <div class="field_st padding-bottom-8">
            <input type="reset" id="botao" value="Reset">
          </div>
          <div>
            <span class="names padding-bottom-8"><i><sub>Mauro Marques</sub></i></span>
          </div>
        </form>
      </div>
    </div>
   </div>
  </div>

<script>
const Myriad = function() {
  const _state_01 = document.getElementById('_state_01').value;
  const _state_02 = document.getElementById('_state_02').value;
  const _state_03 = document.getElementById('_state_03').value;
  const assess_val = document.getElementById('assess_val').value;
  const bedrooms = document.getElementById('bedrooms').value;
  const full_baths = document.getElementById('full_baths').value;
  const half_baths = document.getElementById('half_baths').value;
  const land_sq_ft = document.getElementById('land_sq_ft').value;
  const living_sq_ft = document.getElementById('living_sq_ft').value;
  const year_acq = document.getElementById('year_acq').value;
  const year_built = document.getElementById('year_built').value;
  const zip = document.getElementById('zip').value;

  // Cluster: Roxie
  // const url = encodeURI(`http://127.0.0.1:8002/WsEcl/submit/query/roxie/fn_myriadgetpricereg_web/json?_state_01=${_state_01}&_state_02=${_state_02}&_state_03=${_state_03}&assess_val=${assess_val}&bedrooms=${bedrooms}&full_baths=${full_baths}&half_baths=${half_baths}&land_sq_ft=${land_sq_ft}&living_sq_ft=${living_sq_ft}&year_acq=${year_acq}&year_built=${year_built}&zip=${zip}`);

  // Cluster: hThor
  const url = encodeURI(`http://127.0.0.1:8002/WsEcl/submit/query/hthor/fn_myriadgetpricereg_web/json?_state_01=${_state_01}&_state_02=${_state_02}&_state_03=${_state_03}&assess_val=${assess_val}&bedrooms=${bedrooms}&full_baths=${full_baths}&half_baths=${half_baths}&land_sq_ft=${land_sq_ft}&living_sq_ft=${living_sq_ft}&year_acq=${year_acq}&year_built=${year_built}&zip=${zip}`);


  // console.log(url); // No Chrome: abrir Console com F12 ou CRTL+SHIFT+J e, depois, F5
     
  fetch(url).then(function(Response) {
    return Response.json()
                                     }).then(function(Data) {

    // console.log(Data);

/*
    if (_state_02 === "" && _state_03 === "") {
      alert('Preço do Imóvel (US$) = ' + Data.fn_myriadgetpricereg_webResponse.Results.Preco_Imovel_01.Row[0].preco);
    } else if (_state_03 === "") {
      alert('Preço do Imóvel (US$) = ' + Data.fn_myriadgetpricereg_webResponse.Results.Preco_Imovel_01.Row[0].preco + '\n' + 
            'Preço do Imóvel (US$) = ' + Data.fn_myriadgetpricereg_webResponse.Results.Preco_Imovel_02.Row[0].preco);
    } else {
      alert('Preço do Imóvel (US$) = ' + Data.fn_myriadgetpricereg_webResponse.Results.Preco_Imovel_01.Row[0].preco + '\n' + 
            'Preço do Imóvel (US$) = ' + Data.fn_myriadgetpricereg_webResponse.Results.Preco_Imovel_02.Row[0].preco + '\n' +
            'Preço do Imóvel (US$) = ' + Data.fn_myriadgetpricereg_webResponse.Results.Preco_Imovel_03.Row[0].preco);
    }
*/

    let WUID  = Data.fn_myriadgetpricereg_webResponse.Results.WUID.Row[0].WUID;  // obtendo WUID
    let URLp1 = 'http://127.0.0.1:8010/?Widget=IFrameWidget&src=%2FWsWorkunits%2Fres%2F';
    let URLp2 = '%2F.%2Fres%2Findex.html';
    let FullAddr = URLp1.concat(WUID, URLp2);

    if (_state_02 === "" && _state_03 === "") {
      if (_state_01 != "") {
          window.open(FullAddr);
      }
      alert('O preco estimado do imóvel para o estado: ' + '\n' + '\n' + '   [ ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[0].states + ' ]' + ' = ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[0].preco + ' (US$) ');

    } else if (_state_03 === "") {
      if (_state_01 != "" && _state_02 != "") {
        window.open(FullAddr);
      }
      alert('O preco estimado do imóvel para o estado: ' + '\n' + '\n' + '   [ ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[0].states + ' ]' + ' = ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[0].preco + ' (US$) ' + '\n' + '\n' + '   [ ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[1].states + ' ]' + ' = ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[1].preco + ' (US$) ' + '\n');

    } else {
      if (_state_01 != "" && _state_02 != "" && _state_03 != "") {
        window.open(FullAddr);
      }
      alert('O preco estimado do imóvel para o estado: ' + '\n' + '\n' + '   [ ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[0].states + ' ]' + ' = ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[0].preco + ' (US$) ' + '\n' + '\n' + '   [ ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[1].states + ' ]' + ' = ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[1].preco + ' (US$) ' + '\n' + '\n' + '   [ ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[2].states + ' ]' + ' = ' + Data.fn_myriadgetpricereg_webResponse.Results.Choropleth_USStates.Row[2].preco + ' (US$)');
      }

                                                            }).catch(function(error) {

    if (_state_01 === "") {
      alert('Selecione pelo menos um estado da esquerda para direita. \n' + '   Sequência [ 01  =>  02  =>  03 ]. \n' + '   Nenhum estado foi selecionado: \n' + '      [ ' + _state_01 + ' ]\n' + '      [ ' + _state_02 + ' ]\n' + '      [ ' + _state_03 + ' ]');
                                                                             }

                                                                                     });
                            };

    document.getElementById('botao').addEventListener('click', Myriad);

</script>

</body>
</html>
